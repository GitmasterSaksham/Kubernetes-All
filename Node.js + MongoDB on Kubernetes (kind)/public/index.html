<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>User Management UI</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  >
</head>

<body class="bg-light">

<div class="container py-5">

  <h2 class="text-center mb-4">User Management (MongoDB + Node.js)</h2>

  <!-- Create User Section -->
  <div class="card p-4 mb-4">
    <h4>Create New User</h4>

    <div class="row g-3">
      <div class="col-md-4">
        <input id="name" class="form-control" placeholder="Name">
      </div>
      <div class="col-md-4">
        <input id="email" class="form-control" placeholder="Email">
      </div>
      <div class="col-md-2">
        <input id="age" type="number" class="form-control" placeholder="Age">
      </div>
      <div class="col-md-2">
        <button class="btn btn-primary w-100" onclick="createUser()">Create</button>
      </div>
    </div>
  </div>

  <!-- User List -->
  <div class="card p-4">
    <h4>User List</h4>

    <table class="table table-striped" id="userTable">
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Age</th>
          <th>Actions</th>
        </tr>
      </thead>

      <tbody></tbody>
    </table>
  </div>

</div>

<script>
// Fetch and Display Users
async function loadUsers() {
  const res = await fetch("/users");
  const users = await res.json();

  const tbody = document.querySelector("#userTable tbody");
  tbody.innerHTML = "";

  users.forEach(user => {
    const row = `
      <tr>
        <td>${user.name}</td>
        <td>${user.email}</td>
        <td>${user.age || "-"}</td>
        <td>
          <button class="btn btn-warning btn-sm" onclick="editUser('${user._id}', '${user.name}', '${user.email}', '${user.age}')">Edit</button>
          <button class="btn btn-danger btn-sm" onclick="deleteUser('${user._id}')">Delete</button>
        </td>
      </tr>
    `;
    tbody.innerHTML += row;
  });
}

// Create User
async function createUser() {
  const user = {
    name: document.getElementById("name").value,
    email: document.getElementById("email").value,
    age: document.getElementById("age").value
  };

  await fetch("/users", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(user)
  });

  loadUsers();
}

// Delete User
async function deleteUser(id) {
  await fetch(`/users/${id}`, { method: "DELETE" });
  loadUsers();
}

// Edit User
function editUser(id, name, email, age) {
  const newName = prompt("Update Name:", name);
  const newEmail = prompt("Update Email:", email);
  const newAge = prompt("Update Age:", age);

  if (newName && newEmail) {
    updateUser(id, newName, newEmail, newAge);
  }
}

// Update User
async function updateUser(id, name, email, age) {
  await fetch(`/users/${id}`, {
    method: "PUT",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ name, email, age })
  });

  loadUsers();
}

// Load users when page starts
loadUsers();
</script>

</body>
</html>
